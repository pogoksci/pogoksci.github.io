<!-- /pages/usage-register.html -->
<div id="usage-register-page" class="layout-container">

    <!-- 1. List Section (Visible by default) -->
    <div id="usage-list-section" style="display: flex; flex-direction: column; width: 100%; height: 100%;">
        <!-- Fixed Header -->
        <div class="layout-header">
            <div class="header-top-row">
                <h2>약품 사용량 등록</h2>
            </div>

            <div class="header-actions">
                <!-- 검색창 -->
                <div class="search-container">
                    <span class="material-symbols-outlined" style="color: #888;">search</span>
                    <input type="text" id="usage-search-input" placeholder="약품 검색...">
                </div>

                <!-- 정렬 드롭다운 -->
                <div class="custom-dropdown" id="sort-dropdown">
                    <button class="dropdown-toggle" id="sort-toggle" aria-haspopup="true" aria-expanded="false"
                        style="height: 100%;">
                        <span class="material-symbols-outlined">sort</span>
                        <span id="sort-label" data-value="category_name_kor">한글명(분류)</span>
                        <span class="material-symbols-outlined arrow">expand_more</span>
                    </button>

                    <div class="dropdown-menu" id="sort-menu" role="menu">
                        <div class="dropdown-item" data-value="category_name_kor">
                            <span class="material-symbols-outlined">category</span>
                            한글명(분류)
                        </div>
                        <div class="dropdown-item" data-value="category_name_eng">
                            <span class="material-symbols-outlined">category</span>
                            영문명(분류)
                        </div>
                        <div class="dropdown-item" data-value="name_kor">
                            <span class="material-symbols-outlined">sort_by_alpha</span>
                            한글명(전체)
                        </div>
                        <div class="dropdown-item" data-value="name_eng">
                            <span class="material-symbols-outlined">sort_by_alpha</span>
                            영문명(전체)
                        </div>
                        <div class="dropdown-item" data-value="formula">
                            <span class="material-symbols-outlined">science</span>
                            화학식
                        </div>
                        <div class="dropdown-item" data-value="storage_location">
                            <span class="material-symbols-outlined">location_on</span>
                            위치
                        </div>
                        <div class="dropdown-item" data-value="created_at_desc">
                            <span class="material-symbols-outlined">schedule</span>
                            등록순서
                        </div>
                        <div class="dropdown-item" data-value="exhausted">
                            <span class="material-symbols-outlined">block</span>
                            소모완료약품
                        </div>
                    </div>
                </div>

                <!-- 새로고침 버튼 -->
                <button id="refresh-btn" title="목록 새로고침" aria-label="새로고침" style="height: 100%;">
                    <span class="material-symbols-outlined">refresh</span>
                </button>
            </div>
        </div>

        <!-- Scrollable List -->
        <div id="usage-inventory-list" class="layout-content inventory-list">
            <div class="loading-spinner">목록을 불러오는 중...</div>
        </div>
    </div>

    <!-- 2. Detail Section (Hidden by default, overlays list) -->
    <!-- Detail section also uses standard class but handles its own internal scrolling -->
    <div id="usage-detail-section" class="inventory-detail-page"
        style="display: none; height: 100%; flex-direction: column;">

        <div class="usage-fixed-header" style="flex-shrink: 0; padding: 25px; background: #fff;">
            <div class="detail-top-bar" style="margin-bottom: 15px;">
                <button type="button" id="btn-back-to-list" class="btn-text" style="padding: 0; font-size: 16px;">
                    <span class="material-symbols-outlined" style="vertical-align: bottom;">arrow_back</span>
                    다른 약품 선택
                </button>
            </div>

            <!-- Selected Item Info (Will be injected) -->
            <div id="selected-item-display"></div>
        </div>

        <div class="detail-scroll-container scroll-padding-nav" style="flex-grow: 1; overflow-y: auto; padding: 25px;">
            <div class="form-container-card">
                <h3>사용량 등록</h3>

                <form id="usage-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label>날짜</label>
                            <input type="date" id="usage-date" required>
                        </div>
                        <div class="form-group">
                            <label>과목</label>
                            <select id="usage-subject" required>
                                <option value="통합과학">통합과학</option>
                                <option value="과학탐구실험">과학탐구실험</option>
                                <option value="물리학">물리학</option>
                                <option value="화학">화학</option>
                                <option value="생명과학">생명과학</option>
                                <option value="지구과학">지구과학</option>
                                <option value="동아리">동아리</option>
                                <option value="기타">기타</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>교시</label>
                            <select id="usage-period" required>
                                <option value="1교시">1교시</option>
                                <option value="2교시">2교시</option>
                                <option value="3교시">3교시</option>
                                <option value="4교시">4교시</option>
                                <option value="5교시">5교시</option>
                                <option value="6교시">6교시</option>
                                <option value="7교시">7교시</option>
                                <option value="점심시간">점심시간</option>
                                <option value="방과후">방과후</option>
                            </select>
                        </div>
                    </div>

                    <!-- Unified Usage/Mass Input Section -->
                    <div class="form-group"
                        style="background-color: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px solid #eee; margin-top: 20px;">
                        <label style="color: #00a0b2; margin-bottom: 12px; display: block; font-weight: bold;">사용량 입력 (택
                            1) *</label>

                        <div style="display: flex; gap: 10px; align-items: flex-start;">
                            <!-- Left: Usage Amount -->
                            <div style="flex: 1;">
                                <label for="usage-amount"
                                    style="font-size: 13px; color: #555; display: block; margin-bottom: 4px;">1. 사용량
                                    (<span id="usage-unit-display"></span>)</label>
                                <input type="number" id="usage-amount" placeholder="예: 50" step="0.01" min="0"
                                    style="width: 100%;">
                                <p class="usage-note"
                                    style="font-size: 11px; color: #888; margin-top: 4px; line-height: 1.3;">
                                    ※금번 '사용량'을 모를 경우, 오른쪽에 있는 '사용 후 시약병 질량'에 입력하세요.
                                </p>
                            </div>

                            <!-- Center: OR -->
                            <div
                                style="display: flex; align-items: center; padding-top: 28px; color: #aaa; font-size: 12px;">
                                또는
                            </div>

                            <!-- Right: Remaining Mass -->
                            <div style="flex: 1;">
                                <label for="usage-remaining-mass"
                                    style="font-size: 13px; color: #555; display: block; margin-bottom: 4px;">2. 사용 후
                                    시약병 질량 (g)</label>
                                <input type="number" id="usage-remaining-mass" placeholder="예: 350" step="0.01" min="0"
                                    style="width: 100%;">

                                <p class="usage-note" id="estimated-bottle-mass"
                                    style="font-size: 11px; color: #888; margin-top: 4px; line-height: 1.3;">
                                    ※시약병의 공병 예상 질량: 정보없음
                                </p>

                                <!-- Exhausted Checkbox -->
                                <div class="exhausted-check-wrapper"
                                    style="margin-top: 6px; display: flex; align-items: center; height: 12px;">
                                    <input type="checkbox" id="check-exhausted"
                                        style="margin-right: 6px; height: 12px !important; width: 12px; padding: 0;">
                                    <label for="check-exhausted"
                                        style="font-size: 12px; color: #d32f2f; font-weight: normal; cursor: pointer;">전량
                                        소진시 체크하세요.</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="submit" class="btn-submit">
                        <span class="material-symbols-outlined">save</span>
                        등록하기
                    </button>
                </form>
            </div>

            <div class="history-container-card">
                <h3>사용 기록</h3>
                <div class="table-responsive">
                    <table class="usage-table">
                        <thead>
                            <tr>
                                <th>날짜</th>
                                <th>과목</th>
                                <th>교시</th>
                                <th>사용량</th>
                                <th>재고량</th>
                                <th>수정/삭제</th>
                            </tr>
                        </thead>
                        <tbody id="usage-history-body">
                            <!-- History rows -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>