<div class="layout-container">

    <!-- 1. Header (Standardized) -->
    <div class="layout-header">
        <h2>과학실 설정</h2>
    </div>

    <!-- Tab Navigation (Sticky below header) -->
    <div class="tab-container">
        <button class="tab-button active" data-tab="lab-management" id="tab-btn-lab">
            과학실 관리
        </button>
        <button class="tab-button" data-tab="user-settings" id="tab-btn-user">
            사용자 기초설정
        </button>
        <button class="tab-button" data-tab="db-backup" id="tab-btn-backup">
            DB 백업/복원
        </button>
    </div>

    <!-- 2. Scrollable Content -->
    <div id="lab-settings-content" class="layout-content"
        style="padding: 0 16px 16px 16px; margin: 0 auto; width: 100%; max-width: 800px;">

        <!-- Tab 1: Lab Management -->
        <div id="lab-management" class="tab-content active">
            <div class="settings-section">
                <!-- Removed inner header as page title covers it, or keep as sub-section title? 
                     User said "Science Lab Settings" title position. 
                     The inner "Science Lab Info Settings" h3 is fine as a section title.
                -->
                <div class="section-header">
                    <h3>과학실/과학준비실/약품실 정보 설정</h3>
                </div>

                <div class="form-group">
                    <label for="lab-count">과학실(과학준비실,약품실 등 포함) 개수를 입력하고 설정버튼을 누르세요.</label>
                    <div class="input-count-wrapper" style="display: flex; align-items: center; gap: 8px;">
                        <input type="number" id="lab-count" min="1" max="10" placeholder="개수 입력" value="2"
                            style="flex: 1;">
                        <button id="btn-set-lab-count" class="btn-primary" style="white-space: nowrap;">설정</button>
                    </div>
                </div>

                <div id="lab-rooms-container" class="dynamic-list-container" style="display: none;">
                    <label>과학실 이름 입력</label>
                    <!-- Dynamic Inputs will be appended here -->
                    <div id="lab-rooms-list"></div>
                </div>

                <div class="form-bottom-buttons">
                    <button id="btn-save-labs" type="submit">과학실 정보 저장</button>
                </div>
            </div>
        </div>

        <!-- Tab 2: User Settings -->
        <div id="user-settings" class="tab-content">

            <!-- Academic Year Selector -->
            <div class="settings-section">
                <div class="section-header">
                    <h3>학년도 설정</h3>
                    <!-- Year Selection/Creation Logic -->
                </div>
                <div class="form-group">
                    <label for="semester-select">학년도 선택</label>
                    <div style="display: flex; gap: 10px;">
                        <select id="semester-select">
                            <option value="">학년도를 선택하세요</option>
                            <!-- Options populate dynamically -->
                        </select>
                        <button id="btn-add-semester"
                            style="padding: 0 15px; border: 1px solid #ddd; background: #fff; border-radius: 4px;">
                            <span class="material-symbols-outlined">add</span>
                        </button>
                    </div>
                </div>

                <!-- New Semester Modal (Hidden by default) -->
                <div id="new-semester-form"
                    style="display: none; margin-top: 10px; padding: 10px; background: #f9f9f9; border-radius: 4px;">
                    <label style="display: block; margin-bottom: 8px;">새 학년도 선택</label>
                    <div style="display: flex; gap: 8px;">
                        <select id="new-semester-name" class="form-input" style="flex: 1;"></select>
                        <button id="btn-save-semester"
                            style="background: #00a0b2; color: white; border: none; padding: 6px 12px; border-radius: 4px; white-space: nowrap; margin-top: 5px;">추가</button>
                        <button id="btn-cancel-semester"
                            style="background: #ccc; color: white; border: none; padding: 6px 12px; border-radius: 4px; white-space: nowrap; margin-top: 5px;">취소</button>
                    </div>
                </div>
            </div>

            <!-- Detailed Settings (Visible only when semester is selected) -->
            <div id="semester-details-container" style="display: none">

                <!-- Class Counts -->
                <div class="settings-section" style="margin-top: 16px">
                    <h3>학급 수 설정</h3>
                    <div class="form-group">
                        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                            <div style="flex: 1; min-width: 120px;">
                                <label>1학년 학급 수</label>
                                <input type="number" id="count-grade-1" min="0" placeholder="0">
                            </div>
                            <div style="flex: 1; min-width: 120px;">
                                <label>2학년 학급 수</label>
                                <input type="number" id="count-grade-2" min="0" placeholder="0">
                            </div>
                            <div style="flex: 1; min-width: 120px;">
                                <label>3학년 학급 수</label>
                                <input type="number" id="count-grade-3" min="0" placeholder="0">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Three Columns: Teachers, Subjects, Clubs -->
                <div class="settings-grid" style="margin-top: 16px">
                    <!-- Teachers -->
                    <div class="settings-section">
                        <h3>과학과 교사</h3>
                        <div id="teachers-list" class="dynamic-list-container">
                            <!-- Dynamic Items -->
                        </div>
                        <button id="btn-add-teacher" class="btn-add">
                            <span class="material-symbols-outlined">add</span>추가
                        </button>
                    </div>

                    <!-- Subjects -->
                    <div class="settings-section">
                        <h3>운영 과목</h3>
                        <div id="subjects-list" class="dynamic-list-container">
                            <!-- Dynamic Items -->
                        </div>
                        <button id="btn-add-subject" class="btn-add">
                            <span class="material-symbols-outlined">add</span>추가
                        </button>
                    </div>

                    <!-- Clubs -->
                    <div class="settings-section">
                        <h3>동아리</h3>
                        <div id="clubs-list" class="dynamic-list-container">
                            <!-- Dynamic Items -->
                        </div>
                        <button id="btn-add-club" class="btn-add">
                            <span class="material-symbols-outlined">add</span>추가
                        </button>
                    </div>
                </div>

                <!-- Modification Date (Hidden by default, shown on change detection) -->
                <div id="modification-date-container" class="settings-section"
                    style="display: none; margin-top: 20px; border: 1px solid #ff9800; background-color: #fff3e0;">
                    <div class="section-header">
                        <h3>수정 기준 날짜 입력</h3>
                    </div>
                    <div class="form-group">
                        <label for="modification-date"
                            style="display: block; margin-bottom: 8px; font-weight: bold; color: #e65100;">
                            변경 사항이 감지되었습니다.<br>
                            새로운 버전(기간)을 생성할 기준 날짜를 선택하세요.
                        </label>
                        <input type="date" id="modification-date" class="form-control"
                            style="width: 100%; padding: 10px; border: 1px solid #ffb74d; border-radius: 4px;">
                        <p style="font-size: 12px; color: #666; margin-top: 5px;">
                            * 선택한 날짜부터 새로운 기간으로 적용됩니다.<br>
                            * 이전 기간은 선택한 날짜의 <strong>전날</strong>까지로 자동 설정됩니다.
                        </p>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="form-bottom-buttons" style="margin-top: 20px;">
                    <button id="btn-save-user-settings" type="submit">사용자 설정 저장</button>
                </div>

            </div> <!-- End details container -->

        </div>

        <!-- Tab 3: DB Backup/Restore -->
        <div id="db-backup" class="tab-content">
            <div class="settings-section">
                <div class="section-header">
                    <h3>과학실 설정 데이터 백업/복원</h3>
                </div>

                <div class="settings-grid" style="grid-template-columns: 1fr 1fr; gap: 20px;">
                    <!-- Export Card -->
                    <div style="border: 1px solid #ddd; padding: 20px; border-radius: 8px; background: #fff;">
                        <h4 style="margin-top: 0; color: #00a0b2;">설정 내보내기 (Backup)</h4>
                        <p style="color: #666; font-size: 14px; margin-bottom: 20px;">
                            현재 설정된 과학실, 학년도, 교사, 과목 등 모든 기초 데이터를 JSON 파일로 다운로드합니다.
                        </p>
                        <button id="btn-export-db" class="btn-primary" style="width: 100%;">
                            <span class="material-symbols-outlined"
                                style="font-size: 18px; vertical-align: bottom; margin-right: 5px;">download</span>
                            데이터 내보내기
                        </button>
                    </div>

                    <!-- Import Card -->
                    <div style="border: 1px solid #ddd; padding: 20px; border-radius: 8px; background: #fffcfc;">
                        <h4 style="margin-top: 0; color: #d32f2f;">설정 복원하기 (Restore)</h4>
                        <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                            백업 파일을 업로드하여 설정을 복원합니다.<br>
                            <strong style="color: #d32f2f;">주의: 현재의 모든 기초 설정이 삭제되고 덮어쓰기 됩니다.</strong>
                        </p>
                        <input type="file" id="import-file-input" accept=".json" style="display: none;">
                        <button id="btn-trigger-import" style="width: 100%; background-color: #d32f2f; color: white; border: none; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold;">
                            <span class="material-symbols-outlined"
                                style="font-size: 18px; vertical-align: bottom; margin-right: 5px;">upload</span>
                            데이터 복원하기
                        </button>
                    </div>
                </div>

                <!-- Restore Warning/Status -->
                <div id="restore-status" style="margin-top: 20px; display: none;">
                    <div style="padding: 15px; border-radius: 6px; font-size: 14px;"></div>
                </div>

            </div>
        </div>
    </div>


    <div id="toast-container"
        style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 5000;">
    </div>

    <!-- Custom Version Choice Modal -->
    <div id="version-choice-modal" class="custom-modal-overlay" style="display: none;">
        <div class="custom-modal-content">
            <h3 style="margin-top: 0; margin-bottom: 16px; font-size: 18px; color: #d32f2f;">설정 변경 감지</h3>
            <p class="modal-intro" style="margin-bottom: 20px; color: #333;">
                교사, 운영 과목, 학급 수, 동아리 등 <strong>설정이 변경되었습니다.</strong><br>
                변경 내용을 어떻게 저장하시겠습니까?
            </p>

            <div class="choice-container">
                <!-- Option 1: New Version -->
                <div class="choice-row" style="background-color: #fce4ec; border-color: #f8bbd0;">
                    <div class="choice-desc">
                        <strong style="color: #c2185b;">새로운 기간(버전) 생성</strong>
                        <p>변경 시점부터 새로운 설정이 적용됩니다.<br>기존 설정은 이전 기간으로 보존됩니다.</p>
                    </div>
                    <div class="choice-action">
                        <button id="btn-choice-new" class="btn-choice-primary">새로운 기간 생성</button>
                    </div>
                </div>

                <!-- Option 2: Overwrite -->
                <div class="choice-row">
                    <div class="choice-desc">
                        <strong>현재 기간 유지</strong>
                        <p>현재 학년도의 설정이 바로 수정됩니다.<br>입력 실수 수정 등 단순 변경 시 선택하세요.</p>
                    </div>
                    <div class="choice-action">
                        <button id="btn-choice-overwrite" class="btn-choice-secondary">현재 기간 유지</button>
                    </div>
                </div>
            </div>
            <div style="text-align: right; margin-top: 12px;">
                <button id="btn-choice-cancel"
                    style="background:none; border:none; text-decoration:underline; color:#666; cursor:pointer;">취소
                    (돌아가기)</button>
            </div>
        </div>
    </div>

</div> <!-- End layout-container -->
</content>